<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.mappers.board">
   
   <!-- 게시물 작성 -->
   <insert id="write" parameterType="com.board.domain.BoardVO" useGeneratedKeys="true" keyProperty="bno">
      insert into
      tbl_board(title, writer, pNum)
      values(
      #{title}, #{writer}, #{pNum}
      )
   </insert>
   
   
   <insert id="writeFile" parameterType="hashMap">
      insert into
      file_board(fileBno, latitude, longitude, timeView, fileName, path)
      values
      <foreach collection="fileVOList" item="item" separator=" , ">
      (#{item.fileBno}, #{item.latitude}, #{item.longitude}, #{item.timeView}, #{item.fileName}, #{item.path})
      </foreach>
   </insert>
   
   <!-- 게시물 조회 -->
   <select id="view" parameterType="int" resultType="com.board.domain.BoardVO" >
      select
      bno, title, writer, regDate, viewCnt, pNum
      from
      tbl_board
      where
      bno = #{bno}
   </select>
   
   <select id="viewFile" parameterType="int" resultType="com.board.domain.FileVO" >
      select
      id, fileBno, latitude, longitude, timeView, path, content
      from
      file_board
      where fileBno = #{bno}
      order by timeView
   </select>

   <!-- 게시물 수정 -->
   <update id="modify" parameterType="com.board.domain.BoardVO">
      update tbl_board
      set
      title = #{title},
      writer = #{writer},
      pNum = #{pNum}
      where bno = #{bno}
   </update>
   
   <update id="modifyFile" parameterType="com.board.domain.FileVO">
      update file_board
      set
      timeView = #{timeView},
      latitude = #{latitude},
      longitude = #{longitude},
      content = #{content}
      where id = #{id}
   </update>
   
   <!-- 게시글 조회수 갱신 -->
   <update id="hitViewCnt" parameterType="int">
      update tbl_board
      set 
      viewCnt = viewCnt + 1
      where bno = #{bno};
   </update>
   
   <!-- 게시물 삭제 -->
   <delete id="delete" parameterType="int">
      delete
      from tbl_board
      where bno = #{bno}
   </delete>
   
   <delete id="deleteFile" parameterType="int">
      delete
      from file_board
      where id = #{del}
   </delete>
   
   <select id="fileName" parameterType="int" resultType="String">
      select
      fileName
      from 
      file_board
      where id = #{del} 
   </select>
   
   <!-- 게시글 총 갯수 -->
   <select id="count" resultType="int">
      select count(bno) from tbl_board
   </select>

   <!-- 게시물 목록 + 페이징 + 검색 -->
   <select id="listPageSearch" parameterType="hashMap" resultType="com.board.domain.BoardVO">
       select
           bno, title, writer, regDate, viewCnt, pNum
       from tbl_board
       <if test='searchType.equals("title")'>
           WHERE title LIKE concat('%', #{keyword}, '%')
       </if>
      <if test='searchType.equals("writer")'>
         WHERE writer LIKE concat('%', #{keyword}, '%')
      </if>
      order by bno desc
         limit #{displayPost}, #{postNum}
       </select> 
   
   <!-- 회원가입 -->
   <insert id="register" parameterType="com.board.domain.MemberVO">
      insert into
      reg_board(mID, mPW, mNickname, mEmail)
      values(
      #{mID}, #{mPW}, #{mNickname}, #{mEmail}
      )
   </insert>
   
   <!-- 로그인 -->
   <select id="login" parameterType="com.board.domain.MemberVO" resultType="com.board.domain.MemberVO">
      select
      mID, mPW, mNickname
      from
      reg_board
      where
      mID = #{mID}
   </select>
   
   <delete id="reset" parameterType="int">
      delete
      from tp_board
      where tpBno = #{id}
   </delete>
   
   <insert id="set" parameterType="com.board.domain.TpVO">
      insert into
      tp_board(tpBno, fileBno, tp)
      values(#{tpBno}, #{fileBno}, #{tp})
   </insert>
   
   <select id="viewTp" parameterType="int" resultType="com.board.domain.TpVO">
      select
      tpBno, fileBno, tp
      from tp_board
      where fileBno = #{bno}
   </select>
   

</mapper>